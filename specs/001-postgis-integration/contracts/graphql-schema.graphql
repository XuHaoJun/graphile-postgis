# GraphQL Schema: PostGIS Integration

# GeoJSON Scalar Type
"""
The `GeoJSON` scalar type represents GeoJSON values as specified by
[RFC 7946](https://tools.ietf.org/html/rfc7946).
"""
scalar GeoJSON

# Base Geometry Interface
"""
Base interface for all PostGIS geometry types.
All geometry types implement this interface.
"""
interface GeometryInterface {
  """
  Converts the object to GeoJSON format as specified by RFC 7946.
  """
  geojson: GeoJSON!
  
  """
  Spatial Reference System Identifier (SRID).
  """
  srid: Int!
}

# Dimension-specific Interfaces
interface GeometryXYInterface implements GeometryInterface {
  geojson: GeoJSON!
  srid: Int!
}

interface GeometryXYZInterface implements GeometryInterface {
  geojson: GeoJSON!
  srid: Int!
}

interface GeometryXYMInterface implements GeometryInterface {
  geojson: GeoJSON!
  srid: Int!
}

interface GeometryXYZMInterface implements GeometryInterface {
  geojson: GeoJSON!
  srid: Int!
}

# Point Geometry Type
"""
Represents a Point geometry with X and Y coordinates.
"""
type GeometryPoint implements GeometryInterface & GeometryXYInterface {
  geojson: GeoJSON!
  srid: Int!
  x: Float!
  y: Float!
}

"""
Represents a Point geometry with X, Y, and Z coordinates.
"""
type GeometryPointZ implements GeometryInterface & GeometryXYZInterface {
  geojson: GeoJSON!
  srid: Int!
  x: Float!
  y: Float!
  z: Float!
}

# LineString Geometry Type
"""
Represents a LineString geometry (sequence of connected points).
"""
type GeometryLineString implements GeometryInterface & GeometryXYInterface {
  geojson: GeoJSON!
  srid: Int!
  points: [GeometryPoint!]!
}

"""
Represents a LineString geometry with Z coordinates.
"""
type GeometryLineStringZ implements GeometryInterface & GeometryXYZInterface {
  geojson: GeoJSON!
  srid: Int!
  points: [GeometryPointZ!]!
}

# Polygon Geometry Type
"""
Represents a Polygon geometry (area bounded by exterior ring and optional interior rings).
"""
type GeometryPolygon implements GeometryInterface & GeometryXYInterface {
  geojson: GeoJSON!
  srid: Int!
  exterior: GeometryLineString!
  interiors: [GeometryLineString!]!
}

"""
Represents a Polygon geometry with Z coordinates.
"""
type GeometryPolygonZ implements GeometryInterface & GeometryXYZInterface {
  geojson: GeoJSON!
  srid: Int!
  exterior: GeometryLineStringZ!
  interiors: [GeometryLineStringZ!]!
}

# MultiPoint Geometry Type
"""
Represents a collection of Point geometries.
"""
type GeometryMultiPoint implements GeometryInterface & GeometryXYInterface {
  geojson: GeoJSON!
  srid: Int!
  points: [GeometryPoint!]!
}

"""
Represents a collection of Point geometries with Z coordinates.
"""
type GeometryMultiPointZ implements GeometryInterface & GeometryXYZInterface {
  geojson: GeoJSON!
  srid: Int!
  points: [GeometryPointZ!]!
}

# MultiLineString Geometry Type
"""
Represents a collection of LineString geometries.
"""
type GeometryMultiLineString implements GeometryInterface & GeometryXYInterface {
  geojson: GeoJSON!
  srid: Int!
  lineStrings: [GeometryLineString!]!
}

"""
Represents a collection of LineString geometries with Z coordinates.
"""
type GeometryMultiLineStringZ implements GeometryInterface & GeometryXYZInterface {
  geojson: GeoJSON!
  srid: Int!
  lineStrings: [GeometryLineStringZ!]!
}

# MultiPolygon Geometry Type
"""
Represents a collection of Polygon geometries.
"""
type GeometryMultiPolygon implements GeometryInterface & GeometryXYInterface {
  geojson: GeoJSON!
  srid: Int!
  polygons: [GeometryPolygon!]!
}

"""
Represents a collection of Polygon geometries with Z coordinates.
"""
type GeometryMultiPolygonZ implements GeometryInterface & GeometryXYZInterface {
  geojson: GeoJSON!
  srid: Int!
  polygons: [GeometryPolygonZ!]!
}

# GeometryCollection Type
"""
Represents a collection of different geometry types.
"""
type GeometryCollection implements GeometryInterface {
  geojson: GeoJSON!
  srid: Int!
  geometries: [GeometryInterface!]!
}

# Geography Types (same structure as Geometry, but with different naming)
# Note: In practice, geography types may use the same GraphQL types as geometry
# but with different field names (latitude/longitude vs x/y)

"""
Represents a Geography Point (uses latitude/longitude field names).
"""
type GeographyPoint implements GeometryInterface & GeometryXYInterface {
  geojson: GeoJSON!
  srid: Int!
  longitude: Float!
  latitude: Float!
}

# Example: Table with PostGIS column
"""
Example table type with PostGIS geometry column.
This would be auto-generated by PostGraphile based on your database schema.
"""
type ExampleTable {
  id: Int!
  name: String!
  location: GeometryPoint  # PostGIS geometry column
}

# Example: Query with PostGIS data
type Query {
  """
  Example query field that returns table with PostGIS data.
  """
  exampleTableById(id: Int!): ExampleTable
  allExampleTables: [ExampleTable!]!
}

# Example: Mutation with PostGIS data
type Mutation {
  """
  Example mutation that creates a record with PostGIS data.
  """
  createExampleTable(
    input: CreateExampleTableInput!
  ): CreateExampleTablePayload
  
  """
  Example mutation that updates PostGIS geometry column.
  """
  updateExampleTableById(
    input: UpdateExampleTableByIdInput!
  ): UpdateExampleTableByIdPayload
}

input CreateExampleTableInput {
  name: String!
  location: GeoJSON  # GeoJSON input for geometry column
}

type CreateExampleTablePayload {
  exampleTable: ExampleTable
}

input UpdateExampleTableByIdInput {
  id: Int!
  patch: ExampleTablePatch!
}

input ExampleTablePatch {
  name: String
  location: GeoJSON  # GeoJSON input for geometry column
}

type UpdateExampleTableByIdPayload {
  exampleTable: ExampleTable
}

