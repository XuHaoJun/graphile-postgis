#!/usr/bin/env bash
# Test script for PostGIS plugin
# Requires TEST_DATABASE_URL environment variable to be set

set -e

if [ -z "$TEST_DATABASE_URL" ]; then
  echo "Warning: TEST_DATABASE_URL environment variable is not set"
  echo "Using default database URL: postgres://postgres:postgres@localhost:5432/postgres"
  echo "To use a custom database URL, set TEST_DATABASE_URL, e.g.:"
  echo "  export TEST_DATABASE_URL=postgres://test:test@localhost:5432/postgres"
  TEST_DATABASE_URL="postgres://postgres:test@localhost:5432/postgres"
fi

# Load test schema
echo "Loading test schema..."
psql "$TEST_DATABASE_URL" -f __tests__/fixtures/schema.sql

# Run Jest tests
echo "Running tests..."
export TEST_DATABASE_URL
DEBUG=graphile-postgis:* npx jest "$@"

